<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9V3EP5FGPM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-9V3EP5FGPM');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vol.1: アーキテクチャ編 — Editor ↔ Runtime のリモートコントロール | しるふぁ工房</title>
    <meta name="description" content="WPF Editor と Unity Runtime を NamedPipe で接続する VN Studio のリモートコントロールアーキテクチャを解説。">
    <meta property="og:title" content="Vol.1: アーキテクチャ編 | しるふぁ工房">
    <meta property="og:type" content="article">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="../assets/images/nav_icon.png" type="image/png">
    <link rel="stylesheet" href="article.css">
</head>

<body>

    <nav class="nav" role="navigation" aria-label="メインナビゲーション">
        <div class="nav__inner">
            <a href="../index.html" class="nav__logo">
                <img src="../assets/images/nav_icon.png" alt="" class="nav__logo-img" aria-hidden="true">
                <span>しるふぁ工房</span>
            </a>
            <ul class="nav__menu" role="list">
                <li><a href="../index.html" class="nav__link">Home</a></li>
                <li><a href="../devlog.html" class="nav__link">Devlog</a></li>
                <li><a href="../works.html" class="nav__link">Works</a></li>
                <li><a href="../tools.html" class="nav__link">Tools</a></li>
                <li><a href="../about.html" class="nav__link">About</a></li>
                <li><a href="../links.html" class="nav__link">Links</a></li>
            </ul>
            <button class="nav__hamburger" aria-label="メニューを開く" aria-expanded="false">
                <span></span><span></span><span></span>
            </button>
        </div>
    </nav>

    <main>
        <section class="section section--sm">
            <article class="article">

                <header class="article__header fade-in">
                    <span class="article__vol">VOL.1 — ARCHITECTURE</span>
                    <h1 class="article__title">Editor ↔ Runtime のリモートコントロール</h1>
                    <time class="article__date" datetime="2026-02-19">2026.02.19</time>
                </header>

                <div class="article__body fade-in fade-in-delay-1">

                    <h2>はじめに — なぜ「分離」するのか</h2>

                    <p>
                        通常の Unity 開発では、エディタとランタイムは一体です。
                        Unity Editor のインスペクタでパラメータを変更し、Play ボタンを押してプレビューする。
                        この一体感は汎用的な開発には最適ですが、
                        ビジュアルノベルのように<strong>「テキスト主体」</strong>のコンテンツには過剰です。
                    </p>

                    <p>
                        VN Studio では、この常識を覆し、
                        <strong>エディタ（WPF）とランタイム（Unity）を完全に分離</strong>しました。
                        両者を繋ぐのは、Windows の <strong>NamedPipe</strong> による軽量な双方向通信です。
                    </p>

                    <h2>NamedPipe — 通信の仕組み</h2>

                    <p>
                        NamedPipe は Windows OS が提供するプロセス間通信（IPC）メカニズムです。
                        ファイルシステムのような API でプロセス間にストリームを確立でき、
                        TCP/IP のようなネットワークオーバーヘッドがないため、ローカル環境では極めて高速です。
                    </p>

                    <h3>通信プロトコル</h3>

                    <p>VN Studio では2本のパイプを使用します:</p>

                    <ul>
                        <li><code>VNStudioPreviewPipe</code> — Editor → Runtime（コマンド送信）</li>
                        <li><code>VNStudioPreviewPipe_Editor</code> — Runtime → Editor（応答・ハイライト）</li>
                    </ul>

                    <p>送受信されるメッセージは JSON 形式です。主要なコマンドは以下の通りです:</p>

                    <pre><code>// Editor → Runtime: スクリプトの読み込みと実行
{ "type": "load_script", "payload": "bg school\nしるふぁ \"おはよう\"" }

// Editor → Runtime: 特定行へのジャンプ（ダブルクリック時）
{ "type": "jump_to_source", "payload": "chapter1.scn:42" }

// Runtime → Editor: 現在実行中の行をハイライト
{ "type": "highlight", "payload": "chapter1.scn:42" }</code></pre>

                    <h2>リアルタイムプレビューの実現</h2>

                    <p>
                        このアーキテクチャの真価は、<strong>リアルタイムプレビュー</strong>にあります。
                    </p>

                    <ol>
                        <li>エディタでスクリプトを編集する</li>
                        <li><strong>Run</strong> ボタンを押すと、スクリプト全文が NamedPipe 経由で Unity に送信される</li>
                        <li>Unity Runtime が即座にスクリプトをパースし、ゲームシーンを描画する</li>
                        <li>エディタの任意の行を<strong>ダブルクリック</strong>すると、<code>jump_to_source</code> が送信される</li>
                        <li>Unity 側は <strong>RestoreState</strong>（高速スキャン）で、その行までの状態を瞬時に再構築する</li>
                    </ol>

                    <p>
                        つまり、エディタ上で任意のシーンをダブルクリックするだけで、
                        背景・キャラクター・BGM が即座に再現されるのです。
                        これは従来の「最初から再生して早送り」とは根本的に異なる体験です。
                    </p>

                    <h2>WPF を選んだ理由</h2>

                    <p>
                        エディタに WPF（.NET 8）を選択したのには明確な理由があります:
                    </p>

                    <ul>
                        <li><strong>起動の速さ</strong> — Unity Editor のような重い初期化が不要</li>
                        <li><strong>テキスト編集の快適さ</strong> — AvalonEdit による構文ハイライト・行番号付きの本格エディタ</li>
                        <li><strong>Windowsネイティブの操作性</strong> — ファイルダイアログ、ドラッグ&ドロップなどが自然に使える</li>
                        <li><strong>拡張性</strong> — MSX プレビュー（openMSX 連携）も同じエディタから制御可能</li>
                    </ul>

                    <h2>次回予告</h2>

                    <p>
                        Vol.2 では、このリモートコントロールで送信される
                        <strong>VNScript</strong> の設計思想を解説します。
                        「文章を書くように演出する」とはどういうことか、具体的なコマンド例とともにお届けします。
                    </p>

                </div>

                <nav class="article-nav fade-in">
                    <a href="vol0-philosophy.html">← Vol.0: 哲学編</a>
                    <a href="vol2-script-engine.html">Vol.2: スクリプトエンジン編 →</a>
                </nav>

            </article>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer__inner">
                <div class="footer__brand">
                    <div class="footer__logo">
                        <img src="../assets/images/nav_icon.png" alt="" class="nav__logo-img" aria-hidden="true">
                        しるふぁ工房
                    </div>
                    <p class="footer__tagline">想いを記録にかえて、未来を紡ぐ。</p>
                </div>
                <nav aria-label="フッターナビゲーション1">
                    <p class="footer__nav-title">Pages</p>
                    <ul class="footer__nav-list" role="list">
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="../devlog.html">Devlog</a></li>
                        <li><a href="../works.html">Works</a></li>
                        <li><a href="../tools.html">Tools</a></li>
                        <li><a href="../about.html">About</a></li>
                        <li><a href="../links.html">Links</a></li>
                    </ul>
                </nav>
                <nav aria-label="フッターナビゲーション2">
                    <p class="footer__nav-title">Info</p>
                    <ul class="footer__nav-list" role="list">
                        <li><a href="../contact.html">Contact</a></li>
                        <li><a href="../privacy.html">Privacy Policy</a></li>
                    </ul>
                </nav>
            </div>
            <div class="footer__bottom">
                <p class="footer__copy">© 2026 しるふぁ工房 / Shilfa Studio. All rights reserved.</p>
                <div class="footer__links">
                    <a href="../contact.html">Contact</a>
                    <a href="../privacy.html">Privacy</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>

</html>